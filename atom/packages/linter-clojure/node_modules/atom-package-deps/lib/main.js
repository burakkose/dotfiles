'use strict';

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.install = install;

var _helpers = require('./helpers');

const FS = require('fs');
const Path = require('path');

var _require = require('./view');

const View = _require.View;


// Renamed for backward compatibility
if (typeof window.__steelbrain_package_deps === 'undefined') {
  window.__steelbrain_package_deps = new Set();
}

function install() {
  let name = arguments.length <= 0 || arguments[0] === undefined ? null : arguments[0];
  let enablePackages = arguments.length <= 1 || arguments[1] === undefined ? false : arguments[1];

  if (!name) {
    name = require('atom-package-path').guess();
  }
  if (!name) {
    console.log(`Unable to get package name for file: ${ filePath }`);
    return Promise.resolve();
  }

  var _packagesToInstall = (0, _helpers.packagesToInstall)(name);

  const toInstall = _packagesToInstall.toInstall;
  const toEnable = _packagesToInstall.toEnable;

  let promise = Promise.resolve();

  if (enablePackages && toEnable.length) {
    promise = toEnable.reduce(function (promise, name) {
      atom.packages.enablePackage(name);
      return atom.packages.activatePackage(name);
    }, promise);
  }
  if (toInstall.length) {
    const view = new View(name, toInstall);
    promise = Promise.all([view.show(), promise]).then(function () {
      return (0, _helpers.installPackages)(toInstall, function (name, status) {
        if (status) {
          view.advance();
        } else {
          atom.notifications.addError(`Error Installing ${ name }`, { detail: 'Something went wrong. Try installing this package manually.' });
        }
      });
    });
  }

  return promise;
}
