/**
* Copyright (C) 2012 Paul Thurlow
*
* Permission is hereby granted, free of charge, to any person obtaining a copy 
* of this software and associated documentation files (the "Software"), to deal
* in the Software without restriction, including without limitation the rights
* to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
* copies of the Software, and to permit persons to whom the Software is
* furnished to do so, subject to the following conditions:
* 
* The above copyright notice and this permission notice shall be included in
* all copies or substantial portions of the Software.
* 
* THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
* IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
* FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
* AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
* LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
* OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
* SOFTWARE.
*
* v0.1.5
*/
(function(){var a=function(c){this.options={maxCache:10,enableCache:true,insertOrder:false,returnRoot:false,insert:null,sort:null,clip:null,copy:null,merge:null};this.root={};this.index=0;for(var b in c){if(c.hasOwnProperty(b)){this.options[b]=c[b]}}if(typeof this.options.insert!="function"){this.options.insert=function(e,d){if(this.options.insertOrder&&typeof d.d==="undefined"&&typeof d.o==="undefined"){d={d:d,o:this.index++}}if(e&&e.length){e.push(d)}else{e=[d]}return e}}if(typeof this.options.sort!="function"){if(!this.options.insertOrder){this.options.sort=function(){this.sort()}}else{if(this.options.insertOrder){this.options.sort=function(){this.sort(function(e,d){return e.o-d.o})}}}}if(typeof this.options.clip!="function"){this.options.clip=function(d){if(this.length>d){this.splice(d,this.length-d)}}}if(typeof this.options.copy!="function"){this.options.copy=function(d){return d.slice(0)}}if(typeof this.options.merge!="function"){this.options.merge=function(h,f,g){for(var d=0,e=f.length;d<e;d++){h=this.options.insert.call(this,h,f[d]);this.options.sort.call(h,g);this.options.clip.call(h,this.options.maxCache)}return h}}};a.prototype={_addCacheData:function(c,b){if((this.root===c&&!this.options.returnRoot)||this.options.enableCache===false){return false}if(!c.$d){c.$d={}}c.$d=this.options.insert.call(this,c.$d,b);this.options.sort.call(c.$d);this.options.clip.call(c.$d,this.options.maxCache);return true},_addSuffix:function(g,e,f){var d=g.charAt(0),b=g.substring(1)||null,c={$d:{}};if(b){c.$s=b}if(typeof f[d]==="undefined"){f[d]=c}else{if(typeof f[d].$d==="undefined"){f[d].$d={};if(b&&typeof f[d].$s==="undefined"){f[d].$s=b}}}f[d].$d=this.options.insert.call(this,f[d].$d,e);this.options.sort.call(f[d].$d)},_moveSuffix:function(g,e,f){var d=g.charAt(0),b=g.substring(1)||null,c={$d:{}};if(b){c.$s=b}if(typeof f[d]==="undefined"){f[d]=c}f[d].$d=this.options.copy(e)},_getDataAtNode:function(b,d){var c;if(this.options.enableCache){this.options.sort.call(b.$d,d);c=b.$d}else{c=this._getSubtree(b,d)}if(this.options.insertOrder){c=this._stripInsertOrder(c)}return c?this.options.copy(c):undefined},_stripInsertOrder:function(e){if(typeof e=="undefined"){return}var b=[];for(var c=0,d=e.length;c<d;c++){b.push(e[c].d)}return b},_getSubtree:function(g,f){var c,e=[g],d;while(d=e.pop()){for(var b in d){if(d.hasOwnProperty(b)){if(b=="$d"){if(typeof c=="undefined"){c=[]}c=this.options.merge.call(this,c,d.$d,f)}else{if(b!="$s"){e.push(d[b])}}}}}return c},add:function(g,e){if(typeof g!="string"){return false}if(arguments.length==1){e=g}g=g.toLowerCase();var f=this.root;for(var b=0,c=g.length;b<c;b++){var d=g.charAt(b);if(!f[d]){if(f.$s){if(f.$s==g.substring(b)){if(!this._addCacheData(f,e)){f.$d=this.options.insert.call(this,f.$d,e);this.options.sort.call(f.$d)}break}this._moveSuffix(f.$s,f.$d,f);delete f.$s;if(this.options.enableCache===false){delete f.$d}}if(!f[d]){this._addSuffix(g.substring(b),e,f);this._addCacheData(f,e);break}this._addCacheData(f,e);if(b==c-1){if(f[d].$s){this._moveSuffix(f[d].$s,f[d].$d,f[d]);delete f[d].$s;if(this.options.enableCache===false){delete f[d].$d}this._addSuffix(d,e,f)}else{if(!this._addCacheData(f[d],e)){this._addSuffix(d,e,f)}}}f=f[d]}else{if(b==c-1){this._addCacheData(f,e);if(!this._addCacheData(f[d],e)){this._addSuffix(d,e,f)}}else{this._addCacheData(f,e);f=f[d]}}}},remove:function(b){if(typeof b!=="string"||b===""||this.options.enableCache){return}b=b.toLowerCase();var c,g,k,l=this.root,e,j,f,h=0;for(g=0,k=b.length;g<k;g++){c=b.charAt(g);if(!l[c]){if(l.$s&&l.$s===b.substring(g)){break}else{return}}else{e=l;j=c;l=l[c]}}f=this.options.copy(l.$d);if(this.options.insertOrder){f=this._stripInsertOrder(f)}delete l.$d;delete l.$s;for(var d in l){if(l.hasOwnProperty(d)){h++}}if(!h){delete e[j]}return f},contains:function(f){if(typeof f!=="string"||f==""){return false}f=f.toLowerCase();var e=this.root;for(var b=0,c=f.length;b<c;b++){var d=f.charAt(b);if(!e[d]){if(e.$s&&e.$s===f.substring(b)){return true}else{return false}}else{e=e[d]}}return e.$d&&(typeof e.$s==="undefined")?true:false},find:function(e){if(typeof e!=="string"){return undefined}if(e==""&&!this.options.returnRoot){return undefined}e=e.toLowerCase();var f=this.root;for(var b=0,c=e.length;b<c;b++){var d=e.charAt(b);if(!f[d]){if(f.$s&&f.$s.indexOf(e.substring(b))==0){return this._getDataAtNode(f,e)}else{return undefined}}else{f=f[d]}}return this._getDataAtNode(f,e)}};if(typeof exports!=="undefined"){if(typeof module!=="undefined"&&module.exports){exports=module.exports=a}exports.Triejs=a}else{if(typeof define==="function"&&define.amd){define("triejs",function(){return a})}else{this["Triejs"]=a}}})(this);